<div class="grid grid-cols-1 gap-8 lg:grid-cols-3">
  <!-- Columna Izquierda: Simulador -->
  <div class="lg:col-span-1">
    <section class="sticky top-8 rounded-lg bg-white p-6 shadow-lg">
      <h2 class="mb-4 text-xl font-semibold text-gray-800">Simula tu Inversión</h2>

      <!-- Formulario de Simulación -->
      <form class="space-y-4">
        <div>
          <label for="monto" class="mb-1 block text-sm font-medium text-gray-700"> Monto a invertir (COP) </label>
          <div class="relative">
            <span class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500">$</span>
            <input
              type="number"
              id="monto"
              placeholder="Ej: 5000000"
              [value]="monto()"
              (input)="onMontoChange($event)"
              class="block w-full rounded-md border-gray-300 p-3 pl-7 shadow-sm focus:border-blue-500 focus:ring-blue-500" />
          </div>
        </div>

        <div>
          <label for="dias" class="mb-1 block text-sm font-medium text-gray-700"> Plazo en días </label>
          <input
            type="number"
            id="dias"
            placeholder="Ej: 180"
            [value]="dias()"
            (input)="onDiasChange($event)"
            class="block w-full rounded-md border-gray-300 p-3 shadow-sm focus:border-blue-500 focus:ring-blue-500" />
        </div>
      </form>
    </section>
  </div>

  <!-- Columna Derecha: Resultados y Listado -->
  <div class="lg:col-span-2">
    <!-- 1. Resultados de la Simulación -->
    <section id="resultados" class="mb-8">
      <h2 class="mb-4 text-2xl font-semibold text-gray-900">Resultados de la simulación</h2>

      @if (!monto() || !dias()) {
        <div class="rounded-md bg-blue-50 p-4 text-center text-blue-700 shadow">
          <p>Ingresa un monto y un plazo para ver las mejores opciones para ti.</p>
        </div>
      } @else {
        <div class="space-y-4">
          @for (resultado of resultados(); track resultado.banco.id) {
            <div
              class="flex flex-col items-center space-y-4 rounded-lg bg-white p-4 shadow-md sm:flex-row sm:space-x-4 sm:space-y-0">
              <img
                [src]="resultado.banco.logoUrl"
                [alt]="resultado.banco.nombre"
                class="h-16 w-16 flex-shrink-0 rounded-full border-2 border-gray-200 object-cover" />

              <div class="flex-grow text-center sm:text-left">
                <h3 class="text-lg font-bold">{{ resultado.banco.nombre }}</h3>

                @if (resultado.tasaAplicada) {
                  <p class="text-sm text-gray-600">
                    Tasa E.A. aplicada:
                    <span class="font-semibold text-blue-600">{{
                      resultado.tasaAplicada.tasaEA | percent: '1.2-2'
                    }}</span>
                  </p>
                } @else {
                  <p class="text-sm font-medium text-red-600">
                    {{ resultado.mensaje }}
                  </p>
                }
              </div>

              <div class="flex-shrink-0 rounded-md bg-green-50 p-4 text-center">
                @if (resultado.gananciaEstimada !== null) {
                  <span class="block text-sm text-green-700">Ganancia Estimada</span>
                  <span class="block text-2xl font-bold text-green-600">
                    {{ resultado.gananciaEstimada | currency: 'COP' : '$' : '1.0-0' }}
                  </span>
                } @else {
                  <span class="block text-xl font-bold text-gray-500">-</span>
                }
              </div>
            </div>
          }
        </div>
      }
    </section>

    <!-- 2. Listado de Todas las Tasas (Funcionalidad 1) -->
    <section id="todas-las-tasas">
      <h2 class="mb-4 text-2xl font-semibold text-gray-900">Tasas Vigentes</h2>
      <div class="space-y-6">
        @for (banco of bancos(); track banco.id) {
          <div class="rounded-lg bg-white p-4 shadow-md sm:p-6">
            <div class="mb-3 flex items-center space-x-3">
              <img
                [src]="banco.logoUrl"
                [alt]="banco.nombre"
                class="h-10 w-10 rounded-full border border-gray-200 object-cover" />
              <h3 class="text-xl font-bold text-blue-700">{{ banco.nombre }}</h3>
            </div>

            <div class="space-y-3">
              @for (tasa of banco.tasas; track tasa.id) {
                <div
                  class="grid grid-cols-2 gap-x-4 gap-y-2 rounded-md border border-gray-200 bg-gray-50 p-3 md:grid-cols-4">
                  <div>
                    <span class="block text-xs font-medium text-gray-500">Tasa E.A.</span>
                    <span class="block text-lg font-semibold text-blue-600">{{ tasa.tasaEA | percent: '1.2-2' }}</span>
                  </div>
                  <div>
                    <span class="block text-xs font-medium text-gray-500">Plazo (Días)</span>
                    <span class="block font-medium">{{ tasa.diasMin }} - {{ tasa.diasMax }}</span>
                  </div>
                  <div class="col-span-2">
                    <span class="block text-xs font-medium text-gray-500">Monto (COP)</span>
                    <span class="block font-medium">
                      {{ tasa.montoMin | currency: 'COP' : '$' : '1.0-0' }}
                      <span class="text-gray-500"> a </span>
                      {{ tasa.montoMax | currency: 'COP' : '$' : '1.0-0' }}
                    </span>
                  </div>
                </div>
              }
            </div>
          </div>
        }
      </div>
    </section>
  </div>
</div>
